<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <title>Mapa pokladu</title>
  <style>
    html, body { margin:0; padding:0; }
    * { box-sizing: border-box; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }

    h1 { text-align:center; margin: 20px 0; }
    .wrap { width: 90%; margin: 0 auto 24px; text-align:center; }

    .map-frame {
      width: 100%;
      max-width: 1000px;
      margin: 0 auto 12px;
      overflow: hidden;
      border-radius: 12px;
      border: 2px solid rgba(0,0,0,0.08);
    }
    /* V√Ωchoz√≠ rozmaz√°n√≠ 100px ‚Äì jistota, ≈æe je obr√°zek rozost≈ôen√Ω hned po naƒçten√≠ */
    #map-img {
      display:block;
      width:100%;
      height:auto;
      filter: blur(100px);
      transition: filter .5s ease;
      will-change: filter;
    }

    .under-map { margin: 8px 0 18px; font-size: 1.1rem; }

    .card {
      width: 100%;
      max-width: 820px;
      margin: 0 auto;
      text-align: left;
      padding: 16px;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      background: #fff;
      box-shadow: 0 2px 10px rgba(0,0,0,.04);
    }
    .q-head { font-weight: 700; margin-bottom: 8px; }
    .q-text { margin: 0 0 12px 0; line-height: 1.5; }
    .meta { font-size: .9rem; opacity: .8; margin-bottom: 10px; }

    .row { display: flex; gap: 10px; }
    .row input[type="text"] {
      flex: 1 1 auto;
      padding: 10px 12px;
      border: 1px solid #cbd5e1;
      border-radius: 8px;
      font-size: 1rem;
    }
    .row button {
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      background: #111827;
      color: #fff;
    }
    .status { margin-top: 10px; font-size: .95rem; }
    .ok { color: #0d9488; }
    .bad { color: #b91c1c; }

    .controls { margin-top: 10px; text-align: right; }
    .controls button {
      background: transparent; border: 0; color: #2563eb; cursor: pointer; text-decoration: underline;
    }
  </style>
</head>
<body>
  <h1>üó∫Ô∏è Mapa pokladu</h1>

  <div class="wrap">
    <div class="map-frame">
      <img id="map-img" src="map.png" alt="Mapa pokladu (rozost≈ôen√°)">
    </div>

    <p class="under-map">üîç V√≠te kde to je?</p>

    <div class="card">
      <div class="q-head" id="q-progress">Ot√°zka</div>
      <p class="q-text" id="q-text"></p>
      <div class="meta">Zadej odpovƒõƒè (bez ohledu na diakritiku a velikost p√≠smen).</div>

      <div class="row">
        <input id="answer" type="text" placeholder="Napi≈° odpovƒõƒè‚Ä¶" autocomplete="off">
        <button id="send-btn">Odeslat</button>
      </div>
      <div class="status" id="status"></div>

      <div class="controls">
        <button id="reset-btn" title="Zaƒç√≠t znovu">Resetovat postup</button>
      </div>
    </div>
  </div>

  <script>
    // H√°danky + odpovƒõdi
    const RIDDLES = [
      { q: "1. Bez hlasu pl√°ƒçe, bez neht≈Ø ≈°t√≠p√°, bez nohou sk√°ƒçe, bez pysk≈Ø p√≠p√°.", a: ["v√≠tr","vitr"] },
      { q: "2. Nen√≠ ji vidƒõt, nen√≠ ji c√≠tit, nen√≠ ji sly≈°et, nejde ji chytit. Je za hvƒõzdami a pod horami. a vypl≈àuje pr√°zdn√© j√°my. Byla tu p≈ôedt√≠m a p≈ôijde pak. a nakonec ti vyt≈ôe zrak.", a: ["tma"] },
      { q: "3. V≈°echno ≈æere, v≈°echno se v nƒõm ztr√°c√≠, stromy, kvƒõty, zv√≠≈ôata i pt√°ci. Hry≈æe kov i pl√°ty z ocele, tvrd√Ω k√°men na prach semele. Mƒõsta rozval√≠ a kr√°le skol√≠, vysok√°nsk√© hory svrhne do √∫dol√≠.", a: ["ƒças","cas"] },
      { q: "4. Co m√° mƒõsto, ale ne domy; les, ale ne stromy; a ≈ôeku, ale ne vodu?", a: ["mapa"] },
      { q: "5. Ko≈ôeny m√° skryt√© v zemi, vyp√≠n√° se nad jedlemi, stoup√° po≈ô√°d v√Ω≈° a v√Ω≈°, ale r≈Øst ji nevid√≠≈°.", a: ["hora"] }
    ];

    const KEY_IDX  = "treasure_riddle_idx";
    const KEY_BLUR = "treasure_blur_px";
    const STEP = 4;
    const START_BLUR = 20;

    let idx = parseInt(localStorage.getItem(KEY_IDX) ?? "0", 10);
    if (Number.isNaN(idx)) idx = 0;

    let blurPx = parseInt(localStorage.getItem(KEY_BLUR) ?? `${START_BLUR}`, 10);
    if (Number.isNaN(blurPx)) blurPx = START_BLUR;

    if (idx === 0) {
      blurPx = START_BLUR;
      localStorage.setItem(KEY_BLUR, String(START_BLUR));
    }

    const img = document.getElementById('map-img');
    const qText = document.getElementById('q-text');
    const qProg = document.getElementById('q-progress');
    const input = document.getElementById('answer');
    const btn = document.getElementById('send-btn');
    const status = document.getElementById('status');
    const resetBtn = document.getElementById('reset-btn');

    function applyBlur() {
      const clamped = Math.max(0, Math.min(START_BLUR, blurPx));
      img.style.filter = `blur(${clamped}px)`;
    }
    applyBlur();

    function render() {
      if (idx >= RIDDLES.length) {
        qProg.textContent = "Hotovo üéâ";
        qText.textContent = "Vy≈ôe≈°il(a) jsi v≈°echny h√°danky!";
        input.disabled = true;
        btn.disabled = true;
        status.innerHTML = "<span class='ok'>Skvƒõl√©!</span>";
        return;
      }
      qProg.textContent = `Ot√°zka ${idx + 1}/${RIDDLES.length}`;
      qText.textContent = RIDDLES[idx].q;
      status.textContent = "";
      input.value = "";
      input.focus();
    }
    render();

    const norm = s => s.trim().toLowerCase()
      .normalize('NFD').replace(/[\u0300-\u036f]/g, '');

    function check() {
      if (idx >= RIDDLES.length) return;
      const user = norm(input.value);
      const ok = RIDDLES[idx].a.some(ans => user === norm(ans));
      if (ok) {
        blurPx = Math.max(0, blurPx - STEP);
        idx += 1;
        localStorage.setItem(KEY_BLUR, String(blurPx));
        localStorage.setItem(KEY_IDX, String(idx));
        location.reload();  
      } else {
        status.innerHTML = "<span class='bad'>≈†patn√° odpovƒõƒè, zkus to znovu.</span>";
      }
    }

    btn.addEventListener('click', check);
    input.addEventListener('keydown', e => { if (e.key === 'Enter') check(); });

    resetBtn.addEventListener('click', () => {
      localStorage.removeItem(KEY_IDX);
      localStorage.removeItem(KEY_BLUR);
      location.reload();
    });
  </script>
</body>
</html>
